var EnjoyHint=function(a){var b=this,c={onStart:function(){},onEnd:function(){},onSkip:function(){}},d=$.extend(c,a),e=[],f=0;j=$("body");var g=function(){$(".enjoyhint")&&$(".enjoyhint").remove(),$("body").css({overflow:"hidden"}),$(document).on("touchmove",h),j.enjoyhint({onNextClick:function(){l()},onSkipClick:function(){m()}})},h=function(a){a.preventDefault()},i=function(){j=$("body"),$(".enjoyhint").remove(),$("body").css({overflow:"auto"}),$(document).off("touchmove",h)};b.clear=function(){$(".enjoyhint_next_btn").removeClass(b.nextUserClass),$(".enjoyhint_next_btn").text("Next"),$(".enjoyhint_skip_btn").removeClass(b.skipUserClass),$(".enjoyhint_skip_btn").text("Skip")};var j=$("body"),k=function(){if(e&&e[f]){$(".enjoyhint").removeClass("enjoyhint-step-"+f),$(".enjoyhint").addClass("enjoyhint-step-"+(f+1));var a=e[f];a.onBeforeStart&&"function"==typeof a.onBeforeStart&&a.onBeforeStart();var c=a.timeout||0;setTimeout(function(){if(!a.selector)for(var c in a)if(a.hasOwnProperty(c)&&c.split(" ")[1]){var d=c.indexOf(" ");a.event=c.slice(0,d),a.selector=c.slice(d+1),"next"!=a.event&&"auto"!=a.event&&"custom"!=a.event||(a.event_type=a.event),a.description=a[c]}setTimeout(function(){b.clear()},250),$(document.body).scrollTo(a.selector,a.scrollAnimationSpeed||250,{offset:-100}),setTimeout(function(){var c=$(a.selector),d=n(a.event);j.enjoyhint("show"),j.enjoyhint("hide_next");var e=c;if(a.event_selector&&(e=$(a.event_selector)),a.event_type||"key"!=a.event||c.keydown(function(b){b.which==a.keyCode&&(f++,k())}),1==a.showNext&&j.enjoyhint("show_next"),0==a.showSkip?j.enjoyhint("hide_skip"):j.enjoyhint("show_skip"),1==a.showSkip,a.nextButton&&($(".enjoyhint_next_btn").addClass(a.nextButton.className||""),$(".enjoyhint_next_btn").text(a.nextButton.text||"Next"),b.nextUserClass=a.nextButton.className),a.skipButton&&($(".enjoyhint_skip_btn").addClass(a.skipButton.className||""),$(".enjoyhint_skip_btn").text(a.skipButton.text||"Skip"),b.skipUserClass=a.skipButton.className),a.event_type)switch(a.event_type){case"auto":switch(c[a.event](),a.event){case"click":}return f++,void k();case"custom":o(a.event,function(){f++,p(a.event),k()});break;case"next":j.enjoyhint("show_next")}else j.on(d,a.event_selector||a.selector,function(b){a.keyCode&&b.keyCode!=a.keyCode||(f++,$(this).off(d),k())});var g=Math.max(c.outerWidth(),c.outerHeight()),h=a.radius||Math.round(g/2)+5,i=c.offset(),l=c.outerWidth(),m=c.outerHeight(),q=void 0!==a.margin?a.margin:10,r={x:i.left+Math.round(l/2),y:i.top+Math.round(m/2)-$(document).scrollTop()},s={center_x:r.x,center_y:r.y,text:a.description,top:a.top,bottom:a.bottom,left:a.left,right:a.right,margin:a.margin,scroll:a.scroll};a.shape&&"circle"==a.shape?(s.shape="circle",s.radius=h):(s.radius=0,s.width=l+q,s.height=m+q),j.enjoyhint("render_label_with_shape",s)},a.scrollAnimationSpeed+20||270)},c)}else j.enjoyhint("hide"),d.onEnd(),i()},l=function(){f++,k()},m=function(){var a=e[f],b=$(a.selector);p(a.event),b.off(n(a.event)),d.onSkip(),i()},n=function(a,b){return a+(b?"custom":"")+".enjoy_hint"},o=function(a,b){j.on(n(a,!0),b)},p=function(a){j.off(n(a,!0))};b.runScript=function(){f=0,d.onStart(),k()},b.resumeScript=function(){k()},b.getCurrentStep=function(){return f},b.trigger=function(a){switch(a){case"next":l();break;case"skip":m();break;default:l()}},b.setScript=function(a){a&&(e=a)},b.set=function(a){b.setScript(a)},b.setSteps=function(a){b.setScript(a)},b.run=function(){b.runScript()},b.resume=function(){b.resumeScript()},g()};CanvasRenderingContext2D.prototype.roundRect=function(a,b,c,d,e){return 2*e>c&&(e=c/2),2*e>d&&(e=d/2),this.beginPath(),this.moveTo(a+e,b),this.arcTo(a+c,b,a+c,b+d,e),this.arcTo(a+c,b+d,a,b+d,e),this.arcTo(a,b+d,a,b,e),this.arcTo(a,b,a+c,b,e),this.closePath(),this},function(a){var b={init:function(b){return this.each(function(){function c(a,b){var c=document.createElementNS("http://www.w3.org/2000/svg",a);for(var d in b)c.setAttribute(d,b[d]);return c}var d={onNextClick:function(){},onSkipClick:function(){},animation_time:800};this.enjoyhint_obj={};var e=this.enjoyhint_obj,f=a(this);a("body");e.options=jQuery.extend(d,b),e.gcl={chooser:"enjoyhint"},e.cl={enjoy_hint:"enjoyhint",hide:"enjoyhint_hide",disable_events_element:"enjoyhint_disable_events",btn:"enjoyhint_btn",skip_btn:"enjoyhint_skip_btn",close_btn:"enjoyhint_close_btn",next_btn:"enjoyhint_next_btn",main_canvas:"enjoyhint_canvas",main_svg:"enjoyhint_svg",svg_wrapper:"enjoyhint_svg_wrapper",svg_transparent:"enjoyhint_svg_transparent",kinetic_container:"kinetic_container"},e.canvas_size={w:1.4*a(window).width(),h:1.4*a(window).height()};var g="enj_canvas";e.enjoyhint=a("<div>",{"class":e.cl.enjoy_hint+" "+e.cl.svg_transparent}).appendTo(f),e.enjoyhint_svg_wrapper=a("<div>",{"class":e.cl.svg_wrapper+" "+e.cl.svg_transparent}).appendTo(e.enjoyhint),e.$stage_container=a('<div id="'+e.cl.kinetic_container+'">').appendTo(e.enjoyhint),e.$canvas=a('<canvas id="'+g+'" width="'+e.canvas_size.w+'" height="'+e.canvas_size.h+'" class="'+e.cl.main_canvas+'">').appendTo(e.enjoyhint),e.$svg=a('<svg width="'+e.canvas_size.w+'" height="'+e.canvas_size.h+'" class="'+e.cl.main_canvas+" "+e.cl.main_svg+'">').appendTo(e.enjoyhint_svg_wrapper);var h=a(c("defs")),i=a(c("marker",{id:"arrowMarker",viewBox:"0 0 36 21",refX:"21",refY:"10",markerUnits:"strokeWidth",orient:"auto",markerWidth:"16",markerHeight:"12"})),j=a(c("path",{style:"fill:none; stroke:rgb(255,255,255); stroke-width:2",d:"M0,0 c30,11 30,9 0,20"}));h.append(i.append(j)).appendTo(e.$svg),e.kinetic_stage=new Kinetic.Stage({container:e.cl.kinetic_container,width:e.canvas_size.w,height:e.canvas_size.h}),e.layer=new Kinetic.Layer,e.rect=new Kinetic.Rect({fill:"rgba(0,0,0,0.6)",width:e.canvas_size.w,height:e.canvas_size.h});var k=a("<div>",{"class":e.cl.disable_events_element}).appendTo(e.enjoyhint),l=k.clone().appendTo(e.enjoyhint),m=k.clone().appendTo(e.enjoyhint),n=k.clone().appendTo(e.enjoyhint);e.$skip_btn=a("<div>",{"class":e.cl.skip_btn}).appendTo(e.enjoyhint).html("Skip").click(function(a){e.hide(),e.options.onSkipClick()}),e.$next_btn=a("<div>",{"class":e.cl.next_btn}).appendTo(e.enjoyhint).html("Next").click(function(a){e.options.onNextClick()}),e.$close_btn=a("<div>",{"class":e.cl.close_btn}).appendTo(e.enjoyhint).html("").click(function(a){e.hide(),e.options.onSkipClick()}),e.$canvas.mousedown(function(b){a("canvas").css({left:"4000px"});var c=document.elementFromPoint(b.clientX,b.clientY);return a("canvas").css({left:"0px"}),a(c).click(),!1});var o=0,p=130;e.shape=new Kinetic.Shape({radius:o,center_x:-p,center_y:-p,width:0,height:0,sceneFunc:function(a){var b=this.getContext("2d")._context,c=(this.pos,b.globalCompositeOperation);b.globalCompositeOperation="destination-out",b.beginPath();var d=this.attrs.center_x-Math.round(this.attrs.width/2),e=this.attrs.center_y-Math.round(this.attrs.height/2);b.roundRect(d,e,this.attrs.width,this.attrs.height,this.attrs.radius),b.fillStyle="red",b.fill(),b.globalCompositeOperation=c}}),e.shape.radius=o,e.layer.add(e.rect),e.layer.add(e.shape),e.kinetic_stage.add(e.layer);[e.enjoyhint,k,l,m,n];return e.show=function(){e.enjoyhint.removeClass(e.cl.hide)},e.hide=function(){e.enjoyhint.addClass(e.cl.hide);var a=new Kinetic.Tween({node:e.shape,duration:.002,center_x:-p,center_y:-p});a.play()},e.hide(),e.hideNextBtn=function(){e.$next_btn.addClass(e.cl.hide),e.nextBtn="hide"},e.showNextBtn=function(){e.$next_btn.removeClass(e.cl.hide),e.nextBtn="show"},e.hideSkipBtn=function(){e.$skip_btn.addClass(e.cl.hide)},e.showSkipBtn=function(){e.$skip_btn.removeClass(e.cl.hide)},e.renderCircle=function(a){var b=a.r||0,c=a.x||0,d=a.y||0,f=new Kinetic.Tween({node:e.shape,duration:.2,center_x:c,center_y:d,width:2*b,height:2*b,radius:b});f.play();var g=c-b,h=c+b,i=d-b,j=d+b,k=20;return{x:c,y:d,left:g,right:h,top:i,bottom:j,conn:{left:{x:g-k,y:d},right:{x:h+k,y:d},top:{x:c,y:i-k},bottom:{x:c,y:j+k}}}},e.renderRect=function(a){var b=a.r||0,c=a.x||0,d=a.y||0,f=a.w||0,g=a.h||0,h=20,i=new Kinetic.Tween({node:e.shape,duration:.2,center_x:c,center_y:d,width:f,height:g,radius:b});i.play();var j=Math.round(f/2),k=Math.round(g/2),l=c-j,m=c+j,n=d-k,o=d+k;return{x:c,y:d,left:l,right:m,top:n,bottom:o,conn:{left:{x:l-h,y:d},right:{x:m+h,y:d},top:{x:c,y:n-h},bottom:{x:c,y:o+h}}}},e.renderLabel=function(b){var c=b.x||0,d=b.y||0,f=(b.text||0,e.getLabelElement({x:c,y:d,text:b.text})),g=f.width(),h=f.height(),i=f.offset().left,j=f.offset().left+g,k=f.offset().top-a(document).scrollTop(),l=f.offset().top+h,m=10,n={x:i-m,y:k+Math.round(h/2)},o={x:j+m,y:k+Math.round(h/2)},p={x:i+Math.round(g/2),y:k-m},q={x:i+Math.round(g/2),y:l+m};return f.detach(),setTimeout(function(){a("#enjoyhint_label").remove(),f.appendTo(e.enjoyhint)},e.options.animation_time/2),{label:f,left:i,right:j,top:k,bottom:l,conn:{left:n,right:o,top:p,bottom:q}}},e.renderArrow=function(b){var d=b.x_from||0,f=b.y_from||0,g=b.x_to||0,h=b.y_to||0,i=b.by_top_side,j=0,k=0;i?f>=h?(k=h,j=d):(k=f,j=g):f>=h?(k=f,j=g):(k=h,j=d);b.text||"";e.enjoyhint.addClass(e.cl.svg_transparent),setTimeout(function(){a("#enjoyhint_arrpw_line").remove();var b="M"+d+","+f+" Q"+j+","+k+" "+g+","+h;e.$svg.append(c("path",{style:"fill:none; stroke:rgb(255,255,255); stroke-width:3","marker-end":"url(#arrowMarker)",d:b,id:"enjoyhint_arrpw_line"})),e.enjoyhint.removeClass(e.cl.svg_transparent)},e.options.animation_time/2)},e.getLabelElement=function(b){return a("<div>",{"class":"enjoy_hint_label",id:"enjoyhint_label"}).css({top:b.y+"px",left:b.x+"px"}).html(b.text).appendTo(e.enjoyhint)},e.disableEventsNearRect=function(a){k.css({top:"0",left:"0"}).height(a.top),l.css({top:a.bottom+"px",left:"0"}),m.css({top:"0",left:"0px"}).width(a.left),n.css({top:"0",left:a.right+"px"})},e.renderLabelWithShape=function(a){function b(a,b,c){J=a,K=b,I=c}function c(a,c,d,e,f){var g=[];g=N?a:Q?c:P?d:R?e:f,g&&b(g[0],g[1],g[2])}var d=a.shape||"rect",f={},g=0,h=0,i={top:a.top||0,bottom:a.bottom||0,left:a.left||0,right:a.right||0};switch(d){case"circle":g=h=a.radius;var j={top:a.center_y-h+i.top,bottom:a.center_y+h-i.bottom,left:a.center_x-g+i.left,right:a.center_x+g-i.right},k=j.right-j.left,l=j.bottom-j.top;a.radius=Math.round(Math.min(k,l)/2),g=h=Math.round(a.radius/2);var m=Math.round(k/2),n=Math.round(l/2);a.center_x=j.left+m,a.center_y=j.top+n,f=e.renderCircle({x:a.center_x,y:a.center_y,r:a.radius});break;case"rect":g=Math.round(a.width/2),h=Math.round(a.height/2);var j={top:a.center_y-h+i.top,bottom:a.center_y+h-i.bottom,left:a.center_x-g+i.left,right:a.center_x+g-i.right};a.width=j.right-j.left,a.height=j.bottom-j.top,g=Math.round(a.width/2),h=Math.round(a.height/2),a.center_x=j.left+g,a.center_y=j.top+h,f=e.renderRect({x:a.center_x,y:a.center_y,w:a.width,h:a.height,r:a.radius})}var o={w:e.enjoyhint.width(),h:e.enjoyhint.height()},p=e.getLabelElement({x:0,y:0,text:a.text}),q=p.outerWidth(),r=p.outerHeight();p.remove();var s=a.center_y-h,t=o.h-(a.center_y+h),u=a.center_x-g,v=o.w-(a.center_x+g),w=o.w-a.center_x<a.center_x?"left":"right",x=o.h-a.center_y<a.center_y?"top":"bottom",y=150,z=40,A=y+q+z,B=y+r+z,C=g+y,D=h+y,E="left"==w?a.center_x-C-q:a.center_x+C,F="top"==x?a.center_y-D-r:a.center_y+D;B>s&&B>t&&(F=a.center_y+z),A>u&&A>v&&(E=a.center_x);var G=e.renderLabel({x:E,y:F,text:a.text});e.$next_btn.css({left:E,top:F+r+20});var H=E+e.$next_btn.width()+10;"hide"==e.nextBtn&&(H=E),e.$skip_btn.css({left:H,top:F+r+20}),e.$close_btn.css({right:10,top:10}),e.disableEventsNearRect({top:f.top,bottom:f.bottom,left:f.left,right:f.right});var I=!1,J="left",K="left",L=G.left<=f.x&&G.right>=f.x,M=G.right<f.x,N=(G.left>f.x,G.right<f.left,G.left>f.right,G.bottom<f.top),O=G.top>f.bottom,P=G.bottom>=f.y&&G.top<=f.y,Q=G.bottom<=f.y&&!N,R=G.top>=f.y&&!O;if(L)if(N)b("bottom","top","top");else{if(!O)return;b("top","bottom","bottom")}else M?c(["right","top","top"],["bottom","left","bottom"],["right","left","top"],["top","left","top"],["right","bottom","bottom"]):c(["left","top","top"],["bottom","right","bottom"],["left","right","top"],["top","right","top"],["left","bottom","bottom"]);var S=G.conn[J],T=f.conn[K],U="top"==I;e.renderArrow({x_from:S.x,y_from:S.y,x_to:T.x,y_to:T.y,by_top_side:U})},e.clear=function(){e.ctx.clearRect(0,0,3e3,2e3)},this})},set:function(a){return this.each(function(){this.enjoyhint_obj.setValue(a)}),this},show:function(){return this.each(function(){this.enjoyhint_obj.show()}),this},hide:function(){return this.each(function(){this.enjoyhint_obj.hide()}),this},hide_next:function(){return this.each(function(){this.enjoyhint_obj.hideNextBtn()}),this},show_next:function(){return this.each(function(){this.enjoyhint_obj.showNextBtn()}),this},hide_skip:function(){return this.each(function(){this.enjoyhint_obj.hideSkipBtn()}),this},show_skip:function(){return this.each(function(){this.enjoyhint_obj.showSkipBtn()}),this},render_circle:function(a,b,c){return this.each(function(){this.enjoyhint_obj.renderCircle(a,b,c)}),this},render_label:function(a,b,c){return this.each(function(){this.enjoyhint_obj.renderLabel(a,b,c)}),this},render_label_with_shape:function(a){return this.each(function(){this.enjoyhint_obj.renderLabelWithShape(a)}),this},clear:function(){return this.each(function(){this.enjoyhint_obj.clear()}),this},close:function(a){return this.each(function(){this.enjoyhint_obj.closePopdown()}),this}};a.fn.enjoyhint=function(c){return b[c]?b[c].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof c&&c?(a.error("Method "+c+" does not exist on $.numinput"),this):b.init.apply(this,arguments)}}(window.jQuery);